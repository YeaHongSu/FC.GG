{% extends 'base.html' %}

{% block title %}FC.GG - ìŠ¤í˜ì…œ ìƒì  ì—°ìŠµì‹¤{% endblock %}

{% block extra_meta %}
<meta name="naver-site-verification" content="c1b0a71b768a10669f82da810f13bc34f3953457" />
<meta name="keywords" content="í”¼íŒŒ, í”¼íŒŒì˜¨ë¼ì¸, í”¼íŒŒì˜¨ë¼ì¸4, FCì˜¨ë¼ì¸, ë¹ ì¹­ì½”, ìŠ¤í˜ì…œ ìƒì , ì—í”„ì”¨ì§€ì§€, fcgg, fc.gg">
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/random.css') }}">
{% endblock %}

{% block content %}
<section class="random-section">
    <h1 class="page-title">ìŠ¤íì…œ ìƒì  ì—°ìŠµìœ¼ë¡œ ì•¡ë—Œí•´ ë³¼ê¹Œìš”?</h1>
    <p class="page-subtitle"><span class="text-pink">SSL</span>ê¸‰ í–‰ìš´ì´ ë„ˆë¬´ê°•í•¨ [ì „ë°˜ì „]</p>

    <!-- Ads (ë² ë‚˜íˆ¬ìŠ¤ ê´‘ê³  ê¸°ì… ì˜ˆì •)-->
    <!-- <div class="ad-section">
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7970639123590302" crossorigin="anonymous"></script>
        <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-7970639123590302" data-ad-slot="5624069254"></ins>
        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div> -->
    <!-- ğŸ”¹ ì¤‘ì•™ ë°°ë„ˆ -->
    <div id="vm-top-banner"
         style="width:100%; display:flex; justify-content:center; margin:32px 0;">
    </div>

    <!-- Info Section -->
    <div class="info-grid">
        <!-- Probability Box -->
        <div class="card-modern">
            <div class="card-header-modern">
                <h3 class="card-title-modern">ë“±ê¸‰ë³„ í™•ë¥ </h3>
            </div>
            <div class="card-body-modern">
                <div class="probability-grid">
                    <div class="prob-item prob-sss">SSS: 2.04%</div>
                    <div class="prob-item prob-ss">SS: 4.08%</div>
                    <div class="prob-item prob-s">S: 12.24%</div>
                    <div class="prob-item prob-a">A: 20.41%</div>
                    <div class="prob-item prob-b">B: 36.73%</div>
                    <div class="prob-item prob-c">C: 24.49%</div>
                </div>
            </div>
        </div>

        <!-- Description Box -->
        <div class="card-modern">
            <div class="card-header-modern">
                <h3 class="card-title-modern">ë¹ ì¹­ì½” ì—°ìŠµì‹¤ì´ë€?</h3>
            </div>
            <div class="card-body-modern">
                <p>ë¹ ì¹­ì½” ì—°ìŠµì‹¤ì—ì„œëŠ” ê°€ìƒì˜ <span class="text-primary">FC</span>ë¥¼ í†µí•´ ì¹´ë“œ ë“±ê¸‰ì˜ í™•ë¥ ì„ ì²´í—˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                <p>ì—°ìŠµ í›„ì— <span class="text-info">ì‹¤ì „ìœ¼ë¡œ ê°€ê¸°</span> ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë„ì „í•´ ë³´ì„¸ìš”!</p>
            </div>
        </div>
    </div>

    <!-- FC & Game Mode Selection -->
    <div class="card-modern game-control-card">
        <div class="card-body-modern">
            <div class="game-controls">
                <!-- Game Mode Selector -->
                <div class="mode-selector">
                    <label class="mode-option">
                        <input type="radio" name="songpyeon" value="appa" checked>
                        <span class="mode-label">ì¼ë°˜ê²Œì„</span>
                    </label>
                    <label class="mode-option">
                        <input type="radio" name="songpyeon" value="mom">
                        <span class="mode-label">ìŠ¤íì…œê²Œì„</span>
                    </label>
                </div>

                <!-- FC Info -->
                <div class="fc-info">
                    <div class="fc-balance">
                        <span>í˜„ì¬ ë³´ìœ :</span>
                        <strong id="fc-balance">0</strong> FC
                    </div>
                    <div class="fc-spent">
                        <span>ëˆ„ì  ì†Œëª¨:</span>
                        <strong id="fc-spent">0</strong> FC
                    </div>
                    <button id="charge-fc" class="btn-primary">FC ì¶©ì „í•˜ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Boards -->
    <div id="appa-container" class="game-board-container">
        <h3 class="board-title">ì¼ë°˜ ê²Œì„</h3>
        <div id="appa-matrix" class="game-matrix"></div>
    </div>

    <div id="mom-container" class="game-board-container" style="display:none;">
        <h3 class="board-title">ìŠ¤í˜ì…œ ê²Œì„</h3>
        <div id="mom-matrix" class="game-matrix"></div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
        <button id="reset-board" class="btn-warning">íŒ ì´ˆê¸°í™”</button>
        <a href="https://shop.fconline.nexon.com/Events/250123/TheOnlySSL" target="_blank" class="btn-primary" id="real-action-button">ì‹¤ì „ìœ¼ë¡œ ê°€ê¸°</a>
    </div>
    <!-- ğŸ”¹ ì¤‘ì•™ ë°°ë„ˆ -->
    <div id="vm-bottom-banner"
         style="width:100%; display:flex; justify-content:center; margin:32px 0;">
    </div>

    <!-- <!-- Ads (ë² ë‚˜íˆ¬ìŠ¤ ê´‘ê³  ê¸°ì… ì˜ˆì •)-->
    <div class="ad-section">
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7970639123590302" crossorigin="anonymous"></script>
        <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-7970639123590302" data-ad-slot="5624069254"></ins>
        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    let fcBalance = 0;
    let fcSpent = 0;

    function formatNumber(num) {
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    document.getElementById('charge-fc').addEventListener('click', function() {
        fcBalance += 10000;
        updateFCBalance();
    });

    function updateFCBalance() {
        document.getElementById('fc-balance').innerText = formatNumber(fcBalance);
        document.getElementById('fc-spent').innerText = formatNumber(fcSpent);
    }

    const appaConfig = ['sss', 'ss', 'ss', 's', 's', 's', 's', 's', 's', 'a', 'a', 'a', 'a', 'a', 'a', 'a', 'a', 'a', 'a', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'c', 'c', 'c', 'c', 'c', 'c', 'c', 'c', 'c', 'c', 'c', 'c'];
    const momConfig = ['sss', 'ss', 'ss', 's', 's', 's', 's', 's', 's', 'a', 'a', 'a', 'a', 'a', 'a', 'a', 'a', 'a', 'a', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'c', 'c', 'c', 'c', 'c', 'c', 'c', 'c', 'c', 'c', 'c', 'c'];

    function shuffleWithBRule(array) {
        let counts = { sss: 0, ss: 0, s: 0, a: 0, b: 0, c: 0 };
        const maxCounts = { sss: 1, ss: 2, s: 6, a: 10, b: 18, c: 12 };

        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }

        array = array.filter(type => {
            if (counts[type] < maxCounts[type]) {
                counts[type]++;
                return true;
            }
            return false;
        });

        for (let i = 0; i < array.length; i++) {
            if (array[i] === 'c') {
                if (i > 0 && array[i - 1] === 'c') {
                    array[i - 1] = 'b';
                }
                if (i < array.length - 1 && array[i + 1] === 'c') {
                    array[i + 1] = 'b';
                }
            }
        }
        return array;
    }

    function createMatrix(matrixId, config) {
        const matrix = document.getElementById(matrixId);
        matrix.innerHTML = '';
        shuffleWithBRule(config).forEach((type, index) => {
            const card = document.createElement('div');
            card.classList.add('game-card');

            const front = document.createElement('div');
            front.classList.add('card-front');
            front.innerText = index + 1;

            const back = document.createElement('div');
            back.classList.add('card-back', type);
            back.innerText = type.toUpperCase();

            card.appendChild(front);
            card.appendChild(back);

            card.addEventListener('click', () => {
                if (card.classList.contains('revealed')) return;

                const cost = matrixId === 'appa-matrix' ? 1200 : 2190;
                if (fcBalance >= cost) {
                    card.classList.add('revealed');
                    fcBalance -= cost;
                    fcSpent += cost;
                    updateFCBalance();

                    if (type === 'sss') {
                        setTimeout(() => {
                            alert("SSSê°€ ë‚˜ì™”ìŠµë‹ˆë‹¤! íŒì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.");
                            resetAllBoards();
                        }, 150);
                    }
                } else {
                    alert('FCê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.');
                }
            });

            matrix.appendChild(card);
        });
    }

    function resetAllBoards() {
        createMatrix('appa-matrix', appaConfig);
        createMatrix('mom-matrix', momConfig);
    }

    document.querySelectorAll('input[name="songpyeon"]').forEach(radio => {
        radio.addEventListener('change', function() {
            document.getElementById('appa-container').style.display = 'none';
            document.getElementById('mom-container').style.display = 'none';
            if (this.value === 'appa') {
                document.getElementById('appa-container').style.display = 'block';
            } else if (this.value === 'mom') {
                document.getElementById('mom-container').style.display = 'block';
            }
        });
    });

    document.getElementById('reset-board').addEventListener('click', resetAllBoards);

    resetAllBoards();

    function trackButtonClick() {
        window.dataLayer = window.dataLayer || [];
        dataLayer.push({
            'event': 'realActionButtonClick',
            'click_text': 'ì‹¤ì „ìœ¼ë¡œ ê°€ê¸°',
            'page_url': window.location.href,
            'button_id': 'real-action-button',
            'event_action': 'realActionButtonClick'
        });
    }
</script>
{% endblock %}
