{% extends 'base.html' %}

{% block title %}FC.GG - ìˆ˜ìˆ˜ë£Œ ê³„ì‚°ê¸°{% endblock %}

{% block extra_meta %}
<meta name="naver-site-verification" content="c1b0a71b768a10669f82da810f13bc34f3953457" />
<meta name="keywords" content="í”¼íŒŒ, í”¼íŒŒì˜¨ë¼ì¸, í”¼íŒŒì˜¨ë¼ì¸4, FCì˜¨ë¼ì¸, ìˆ˜ìˆ˜ë£Œ ê³„ì‚°ê¸°, ì—í”„ì”¨ì§€ì§€, fcgg, fc.gg">
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/calculate.css') }}">
{% endblock %}

{% block content %}
<section class="calculator-section">
    <h1 class="page-title">BP ë¶€ì¡±í•  ì¼ ì—†ì´ íŒ€ì„ ë§ì¶°ë³¼ê¹Œìš”?</h1>
    <p class="page-subtitle">ë” ê°„í¸í•´ì§„ ìˆ˜ìˆ˜ë£Œ ê³„ì‚°ê¸°ë¥¼ ì´ìš©í•´ ë³´ì„¸ìš”!</p>
    <!-- ğŸ”¹ ì¤‘ì•™ ë°°ë„ˆ -->
    <div id="vm-top-banner"
         style="width:100%; display:flex; justify-content:center; margin:32px 0;">
    </div>

    <!-- Ads (ë² ë‚˜íˆ¬ìŠ¤ ê´‘ê³  ê¸°ì… ì˜ˆì •)-->
    <!-- <div class="ad-container">
        <ins class="kakao_ad_area" style="display:none;"
            data-ad-unit="DAN-PWbZJXHgqkT7GvAj"
            data-ad-width="728"
            data-ad-height="90"></ins>
        <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script>
    </div> -->

    <div class="card-modern calculator-card">
        <div class="card-body-modern">
            <h4 class="section-title">íŒë§¤ ì˜ˆì • ê¸ˆì•¡ (BP)</h4>

            <div id="players-container">
                <div class="player-row">
                    <div class="input-group">
                        <input type="text" class="form-input price-input-trillion" placeholder="ì¡° ë‹¨ìœ„">
                        <span class="input-suffix">ì¡°</span>
                    </div>
                    <div class="input-group">
                        <input type="text" class="form-input price-input-billion" placeholder="ì–µ ë‹¨ìœ„">
                        <span class="input-suffix">ì–µ</span>
                    </div>
                    <div class="input-group small">
                        <input type="number" class="form-input count-input" value="1" min="1" max="10">
                        <span class="input-suffix">ëª…</span>
                    </div>
                    <div class="input-group">
                        <select class="form-select coupon-select">
                            <option value="0">ì¿ í° ì—†ìŒ</option>
                            <option value="0.1">10% í• ì¸</option>
                            <option value="0.15">15% í• ì¸</option>
                            <option value="0.2">20% í• ì¸</option>
                            <option value="0.25">25% í• ì¸</option>
                            <option value="0.3">30% í• ì¸</option>
                            <option value="0.35">35% í• ì¸</option>
                            <option value="0.4">40% í• ì¸</option>
                            <option value="0.5">50% í• ì¸</option>
                        </select>
                    </div>
                    <button class="btn-remove remove-player">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
            </div>

            <button class="btn-outline" id="add-player">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                ì…ë ¥ì°½ ì¶”ê°€
            </button>

            <div class="discount-section">
                <h4 class="section-title">í• ì¸ ì˜µì…˜</h4>
                <p class="discount-info">ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ(40%)</p>

                <label class="toggle-switch">
                    <input type="checkbox" id="premium_pc">
                    <span class="toggle-slider"></span>
                    <span class="toggle-label">í”„ë¦¬ë¯¸ì—„ PCë°© (30% í• ì¸)</span>
                </label>

                <label class="toggle-switch">
                    <input type="checkbox" id="top_class">
                    <span class="toggle-slider"></span>
                    <span class="toggle-label">TOP CLASS (20% í• ì¸)</span>
                </label>
            </div>

            <button class="btn-primary btn-full" id="calculate_button">ìˆ˜ìˆ˜ë£Œ ê³„ì‚°í•˜ê¸°</button>

            <div class="result-card">
                <p id="result_fee" class="result-fee">ìµœì¢… ìˆ˜ìˆ˜ë£Œ: 0 BP</p>
                <p id="result_receive" class="result-receive">ìµœì¢… ë°›ëŠ” ê¸ˆì•¡: 0 BP</p>
            </div>
        </div>
    </div>
    <!-- ğŸ”¹ ì¤‘ì•™ ë°°ë„ˆ -->
    <div id="vm-bottom-banner"
         style="width:100%; display:flex; justify-content:center; margin:32px 0;">
    </div>
</section>

<!-- Ads (ë² ë‚˜íˆ¬ìŠ¤ ê´‘ê³  ê¸°ì… ì˜ˆì •)-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7970639123590302" crossorigin="anonymous"></script>
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-7970639123590302" data-ad-slot="5624069254"></ins>
<script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
{% endblock %}

{% block extra_js %}
<script>
    function formatNumberWithCommas(num) {
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }

    function removeCommas(num) {
        return num.toString().replace(/,/g, '');
    }

    function getTotalSalePrice(player) {
        var trillionInput = player.querySelector(".price-input-trillion");
        var billionInput = player.querySelector(".price-input-billion");
        var trillion = parseInt(removeCommas(trillionInput.value) || "0") * 1000000000000;
        var billion = parseInt(removeCommas(billionInput.value) || "0") * 100000000;
        return trillion + billion;
    }

    function addCommaFormattingAndCalculation(input) {
        input.addEventListener('input', function(event) {
            let value = removeCommas(event.target.value);
            if (!isNaN(value) && value.length > 0) {
                event.target.value = formatNumberWithCommas(Number(value));
            }
            calculateFees();
        });
    }

    function calculateFees() {
        var players = document.querySelectorAll(".player-row");
        var totalFee = 0;
        var totalReceive = 0;
        var valid = true;

        players.forEach(function(player) {
            var salePrice = getTotalSalePrice(player);

            if (isNaN(salePrice) || salePrice <= 0) {
                valid = false;
                player.querySelector(".price-input-trillion").classList.add("is-invalid");
                player.querySelector(".price-input-billion").classList.add("is-invalid");
            } else {
                player.querySelector(".price-input-trillion").classList.remove("is-invalid");
                player.querySelector(".price-input-billion").classList.remove("is-invalid");

                var count = parseInt(player.querySelector(".count-input").value);
                var discount = parseFloat(player.querySelector(".coupon-select").value);

                var baseFee = salePrice * 0.4 * count;
                var fee = baseFee;

                var isPremiumPC = document.getElementById("premium_pc").checked ? 0.3 : 0;
                var isTopClass = document.getElementById("top_class").checked ? 0.2 : 0;

                var totalDiscount = discount + isPremiumPC + isTopClass;
                fee = baseFee * (1 - totalDiscount);
                fee = Math.round(fee);
                var receive = (salePrice * count) - fee;

                totalFee += fee;
                totalReceive += receive;
            }
        });

        if (!valid) {
            document.getElementById("result_fee").textContent = "íŒë§¤ ê¸ˆì•¡ ì…ë ¥ì´ í•„ìš”í•©ë‹ˆë‹¤!";
            document.getElementById("result_receive").textContent = "";
            return;
        }

        document.getElementById("result_receive").textContent = "ìµœì¢… ë°›ëŠ” ê¸ˆì•¡: " + totalReceive.toLocaleString() + " BP";
        document.getElementById("result_fee").textContent = "ìµœì¢… ìˆ˜ìˆ˜ë£Œ: " + totalFee.toLocaleString() + " BP";
    }

    document.getElementById("add-player").addEventListener("click", function() {
        var container = document.getElementById("players-container");
        var newRow = document.createElement("div");
        newRow.classList.add("player-row");
        newRow.innerHTML = `
            <div class="input-group">
                <input type="text" class="form-input price-input-trillion" placeholder="ì¡°">
                <span class="input-suffix">ì¡°</span>
            </div>
            <div class="input-group">
                <input type="text" class="form-input price-input-billion" placeholder="ì–µ">
                <span class="input-suffix">ì–µ</span>
            </div>
            <div class="input-group small">
                <input type="number" class="form-input count-input" value="1" min="1" max="10">
                <span class="input-suffix">ëª…</span>
            </div>
            <div class="input-group">
                <select class="form-select coupon-select">
                    <option value="0">ì¿ í° ì—†ìŒ</option>
                    <option value="0.1">10% í• ì¸</option>
                    <option value="0.15">15% í• ì¸</option>
                    <option value="0.2">20% í• ì¸</option>
                    <option value="0.25">25% í• ì¸</option>
                    <option value="0.3">30% í• ì¸</option>
                    <option value="0.35">35% í• ì¸</option>
                    <option value="0.4">40% í• ì¸</option>
                    <option value="0.5">50% í• ì¸</option>
                </select>
            </div>
            <button class="btn-remove remove-player">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        `;
        container.appendChild(newRow);

        addCommaFormattingAndCalculation(newRow.querySelector(".price-input-trillion"));
        addCommaFormattingAndCalculation(newRow.querySelector(".price-input-billion"));
        newRow.querySelector(".count-input").addEventListener("input", calculateFees);
        newRow.querySelector(".coupon-select").addEventListener("change", calculateFees);

        newRow.querySelector(".remove-player").addEventListener("click", function() {
            newRow.remove();
            calculateFees();
        });
    });

    document.querySelectorAll('.price-input-trillion, .price-input-billion, .count-input, .coupon-select, #premium_pc, #top_class').forEach(function(input) {
        if (input.classList.contains("price-input-trillion") || input.classList.contains("price-input-billion")) {
            addCommaFormattingAndCalculation(input);
        } else {
            input.addEventListener("input", calculateFees);
            input.addEventListener("change", calculateFees);
        }
    });

    document.getElementById("calculate_button").addEventListener("click", calculateFees);
</script>
{% endblock %}
